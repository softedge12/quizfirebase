<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
  <style>
    body {
      background-color: rgba(50, 117, 249, 30%);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 20px 0;
    }
    .card {
      width: 90%;
      max-width: 400px;
      margin-top: 30px;
      border-radius: 25px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    .card-header {
      background-color: #3275F9;
      border-top-left-radius: 25px;
      border-top-right-radius: 25px;
    }
  </style>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA2xKyrBV9rO8vVMfzvxPMUAfV19y6eTeQ",
      authDomain: "educationalwebsite-2247d.firebaseapp.com",
      databaseURL: "https://educationalwebsite-2247d-default-rtdb.firebaseio.com",
      projectId: "educationalwebsite-2247d",
      storageBucket: "educationalwebsite-2247d.firebasestorage.app",
      messagingSenderId: "711744017075",
      appId: "1:711744017075:web:11429b93a8767d9b2556c6"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const pageID = "page1"; // वेब पेज 1 के लिए PageID

    function login(event) {
      event.preventDefault();  // यह लाइन फ़ॉर्म सबमिट के समय पेज को रीलोड होने से रोकता है।

      const email = document.getElementById("uid").value;
      const password = document.getElementById("pass").value;

      const dbRef = db.ref('webpages/' + pageID + '/users');
      dbRef.once('value', (snapshot) => {
        let isAuthenticated = false;
        snapshot.forEach((childSnapshot) => {
          const userData = childSnapshot.val();
          if (userData.username === email && userData.password === password) {
            const expiryDate = new Date(userData.expiryDate);
            if (expiryDate >= new Date()) {
              isAuthenticated = true;
              window.location.href = "main.html";
            } else {
              alert("Your account has expired.");
            }
          }
        });
        if (!isAuthenticated) {
          document.getElementById("RetMsg").innerText = "Invalid credentials or expired account.";
          document.getElementById("RetMsg").style.display = "block";
        }
      });
    }

    function clearMsg() {
      document.getElementById("RetMsg").style.display = "none";
    }
  </script>
</head>
<body>
  <div class="card shadow rounded">
    <h5 class="card-header text-white p-3">Login for Page 1</h5>
    <div class="card-body p-4">
      <!-- Form added here -->
      <form onsubmit="login(event)">
        <div class="input-group mb-3">
          <span class="input-group-text">User</span>
          <input type="text" class="form-control" id="uid" placeholder="Email" onchange="clearMsg()">
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text">Password</span>
          <input type="password" class="form-control" id="pass" placeholder="Password" onchange="clearMsg()">
        </div>
        <div id="RetMsg" class="alert alert-danger" style="display:none"></div>
        <button type="submit" class="btn btn-primary float-end px-5">Login</button>
      </form>
    </div>
  </div>
</body>
</html>
